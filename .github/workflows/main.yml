name: Selenide Java CI

on: [ push, workflow_dispatch ]

jobs:
  integration-tests:
    runs-on: ubuntu-latest

    services:
      selenium:
        image: selenoid/chrome:96.0
        ports:
          - 4444:4444
        options: --shm-size="2g"
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: 11
          distribution: 'adopt'
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew
      - name: Build with Gradle
        run: ./gradlew clean test -Denvironment=local_chrome -DbrowserVersion=96.0
      - name: Prepare report
        uses: Xotabu4/send-to-allure-server-action@1
        id: ${{always}}
        with:
          allure-server-url: 'http://192.168.1.22:53764/'